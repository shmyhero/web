"use strict";function TradeView(e){this.$el=$(e.el),this.cacheDoms(),this.initEvents()}var dataObj = null;var pageName="trade",userId=util.urlParse("userId"),positionId=util.urlParse("positionId"),tradeId=util.urlParse("tradeId"),securityId=null;TradeView.prototype.render=function(e){return e=e||{},e.self=e.self||{},this.$content.html(template("tradeTemplate",e)),this.$tips.html(template("tipsTemplate",{referCode:e.self.referCode,durationDays:e.durationDays,PLRefCcy:e.PLRefCcy,currencyDisplay:e.currencyDisplay})),this},TradeView.prototype.fetch=function(){if(userId&&positionId){var e=this;$.ajax({url:"https://cn1.api.tradehero.mobi/api/social/sharePosition",data:{userId:userId,positionId:positionId,tradeId:tradeId},success:function(t){dataObj = t;console.log(t),document.title=t.securityName,securityId=t.securityId,e.render(t),$.doActionAgain(pageName)}})}},TradeView.prototype.cacheDoms=function(){this.$content=this.$el.find(".trade-container"),this.$tips=this.$el.find(".tips")},TradeView.prototype.initEvents=function(){this.$el.on("click",".footer .btn-action",this.doAction.bind(this)),this.$el.on("click",".btn-download",this.doDownload.bind(this))},TradeView.prototype.doDownload=function(){$.track({eventType:"ShareDownloadTrade",userId:userId,sharerId:userId},function(){$.download()})},TradeView.prototype.doAction=function(e){securityId&&(window.auth.check()?($.track({eventType:"ShareClickTrade",userId:window.auth.user.id,sharerId:userId}),$.ajax({type:"POST",url:"https://cn1.api.tradehero.mobi/api/watchlistPositions?securityId",data:{securityId:securityId},beforeSend:function(){$(e.target).attr("disabled","disabled")},success:function(){$(document).trigger("modal:show",".modal.action")},error:function(e){alert(window.util.getErrorMsg(e.response))},complete:function(){$(e.target).removeAttr("disabled")}})):window.auth.redirect(pageName))},$(function(){var e=new TradeView({el:"body"});e.fetch(),$.track({eventType:"ShareDisplayTrade",userId:userId,sharerId:userId})});